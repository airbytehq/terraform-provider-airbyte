version: 6.48.15

type: DeclarativeSource

check:
  type: CheckStream
  stream_names:
    - Rates

definitions:
  streams:
    Rates:
      type: DeclarativeStream
      name: Rates
      retriever:
        type: SimpleRetriever
        requester:
          $ref: "#/definitions/base_requester"
          path: /exchangerates_data/{{ stream_interval.start_time }}
          http_method: GET
          request_parameters:
            base: "{{ config['base'] }}"
        record_selector:
          type: RecordSelector
          extractor:
            type: DpathExtractor
            field_path: []
        decoder:
          type: JsonDecoder
      incremental_sync:
        type: DatetimeBasedCursor
        cursor_field: date
        cursor_datetime_formats:
          - "%Y-%m-%d"
        datetime_format: "%Y-%m-%d"
        start_datetime:
          type: MinMaxDatetime
          datetime: "{{ config[\"start_date\"] }}"
          datetime_format: "%Y-%m-%dT%H:%M:%SZ"
        end_datetime:
          type: MinMaxDatetime
          datetime: "{{ now_utc().strftime('%Y-%m-%dT%H:%M:%SZ') }}"
          datetime_format: "%Y-%m-%dT%H:%M:%SZ"
        step: P1D
        cursor_granularity: P1D
      schema_loader:
        type: InlineSchemaLoader
        schema:
          $ref: "#/schemas/Rates"
  base_requester:
    type: HttpRequester
    url_base: https://api.apilayer.com
    authenticator:
      type: ApiKeyAuthenticator
      api_token: "{{ config[\"api_key\"] }}"
      inject_into:
        type: RequestOption
        field_name: apikey
        inject_into: header

streams:
  - $ref: "#/definitions/streams/Rates"

spec:
  type: Spec
  connection_specification:
    type: object
    $schema: http://json-schema.org/draft-07/schema#
    required:
      - start_date
      - api_key
      - base
    properties:
      start_date:
        type: string
        order: 0
        title: Start date
        format: date-time
        pattern: ^[0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}:[0-9]{2}:[0-9]{2}Z$
      api_key:
        type: string
        order: 1
        title: API Key
        airbyte_secret: true
      base:
        type: string
        description: What base currency are you looking for? (e.g GBP,USD)
        order: 2
        title: Base
    additionalProperties: true

metadata:
  autoImportSchema:
    Rates: true
  testedStreams:
    Rates:
      hasRecords: true
      streamHash: 07361af2711839e5f74bcc073aa00689e2ef9498
      hasResponse: true
      primaryKeysAreUnique: true
      primaryKeysArePresent: true
      responsesAreSuccessful: true
  assist: {}

schemas:
  Rates:
    type: object
    $schema: http://json-schema.org/schema#
    additionalProperties: true
    properties:
      base:
        type:
          - string
          - "null"
      date:
        type: string
      historical:
        type:
          - boolean
          - "null"
      rates:
        type:
          - object
          - "null"
        properties:
          AED:
            type:
              - number
              - "null"
          AFN:
            type:
              - number
              - "null"
          ALL:
            type:
              - number
              - "null"
          AMD:
            type:
              - number
              - "null"
          ANG:
            type:
              - number
              - "null"
          AOA:
            type:
              - number
              - "null"
          ARS:
            type:
              - number
              - "null"
          AUD:
            type:
              - number
              - "null"
          AWG:
            type:
              - number
              - "null"
          AZN:
            type:
              - number
              - "null"
          BAM:
            type:
              - number
              - "null"
          BBD:
            type:
              - number
              - "null"
          BDT:
            type:
              - number
              - "null"
          BGN:
            type:
              - number
              - "null"
          BHD:
            type:
              - number
              - "null"
          BIF:
            type:
              - number
              - "null"
          BMD:
            type:
              - number
              - "null"
          BND:
            type:
              - number
              - "null"
          BOB:
            type:
              - number
              - "null"
          BRL:
            type:
              - number
              - "null"
          BSD:
            type:
              - number
              - "null"
          BTC:
            type:
              - number
              - "null"
          BTN:
            type:
              - number
              - "null"
          BWP:
            type:
              - number
              - "null"
          BYN:
            type:
              - number
              - "null"
          BYR:
            type:
              - number
              - "null"
          BZD:
            type:
              - number
              - "null"
          CAD:
            type:
              - number
              - "null"
          CDF:
            type:
              - number
              - "null"
          CHF:
            type:
              - number
              - "null"
          CLF:
            type:
              - number
              - "null"
          CLP:
            type:
              - number
              - "null"
          CNY:
            type:
              - number
              - "null"
          COP:
            type:
              - number
              - "null"
          CRC:
            type:
              - number
              - "null"
          CUC:
            type:
              - number
              - "null"
          CUP:
            type:
              - number
              - "null"
          CVE:
            type:
              - number
              - "null"
          CZK:
            type:
              - number
              - "null"
          DJF:
            type:
              - number
              - "null"
          DKK:
            type:
              - number
              - "null"
          DOP:
            type:
              - number
              - "null"
          DZD:
            type:
              - number
              - "null"
          EGP:
            type:
              - number
              - "null"
          ERN:
            type:
              - number
              - "null"
          ETB:
            type:
              - number
              - "null"
          EUR:
            type:
              - number
              - "null"
          FJD:
            type:
              - number
              - "null"
          FKP:
            type:
              - number
              - "null"
          GBP:
            type:
              - number
              - "null"
          GEL:
            type:
              - number
              - "null"
          GGP:
            type:
              - number
              - "null"
          GHS:
            type:
              - number
              - "null"
          GIP:
            type:
              - number
              - "null"
          GMD:
            type:
              - number
              - "null"
          GNF:
            type:
              - number
              - "null"
          GTQ:
            type:
              - number
              - "null"
          GYD:
            type:
              - number
              - "null"
          HKD:
            type:
              - number
              - "null"
          HNL:
            type:
              - number
              - "null"
          HRK:
            type:
              - number
              - "null"
          HTG:
            type:
              - number
              - "null"
          HUF:
            type:
              - number
              - "null"
          IDR:
            type:
              - number
              - "null"
          ILS:
            type:
              - number
              - "null"
          IMP:
            type:
              - number
              - "null"
          INR:
            type:
              - number
              - "null"
          IQD:
            type:
              - number
              - "null"
          IRR:
            type:
              - number
              - "null"
          ISK:
            type:
              - number
              - "null"
          JEP:
            type:
              - number
              - "null"
          JMD:
            type:
              - number
              - "null"
          JOD:
            type:
              - number
              - "null"
          JPY:
            type:
              - number
              - "null"
          KES:
            type:
              - number
              - "null"
          KGS:
            type:
              - number
              - "null"
          KHR:
            type:
              - number
              - "null"
          KMF:
            type:
              - number
              - "null"
          KPW:
            type:
              - number
              - "null"
          KRW:
            type:
              - number
              - "null"
          KWD:
            type:
              - number
              - "null"
          KYD:
            type:
              - number
              - "null"
          KZT:
            type:
              - number
              - "null"
          LAK:
            type:
              - number
              - "null"
          LBP:
            type:
              - number
              - "null"
          LKR:
            type:
              - number
              - "null"
          LRD:
            type:
              - number
              - "null"
          LSL:
            type:
              - number
              - "null"
          LTL:
            type:
              - number
              - "null"
          LVL:
            type:
              - number
              - "null"
          LYD:
            type:
              - number
              - "null"
          MAD:
            type:
              - number
              - "null"
          MDL:
            type:
              - number
              - "null"
          MGA:
            type:
              - number
              - "null"
          MKD:
            type:
              - number
              - "null"
          MMK:
            type:
              - number
              - "null"
          MNT:
            type:
              - number
              - "null"
          MOP:
            type:
              - number
              - "null"
          MRU:
            type:
              - number
              - "null"
          MUR:
            type:
              - number
              - "null"
          MVR:
            type:
              - number
              - "null"
          MWK:
            type:
              - number
              - "null"
          MXN:
            type:
              - number
              - "null"
          MYR:
            type:
              - number
              - "null"
          MZN:
            type:
              - number
              - "null"
          NAD:
            type:
              - number
              - "null"
          NGN:
            type:
              - number
              - "null"
          NIO:
            type:
              - number
              - "null"
          NOK:
            type:
              - number
              - "null"
          NPR:
            type:
              - number
              - "null"
          NZD:
            type:
              - number
              - "null"
          OMR:
            type:
              - number
              - "null"
          PAB:
            type:
              - number
              - "null"
          PEN:
            type:
              - number
              - "null"
          PGK:
            type:
              - number
              - "null"
          PHP:
            type:
              - number
              - "null"
          PKR:
            type:
              - number
              - "null"
          PLN:
            type:
              - number
              - "null"
          PYG:
            type:
              - number
              - "null"
          QAR:
            type:
              - number
              - "null"
          RON:
            type:
              - number
              - "null"
          RSD:
            type:
              - number
              - "null"
          RUB:
            type:
              - number
              - "null"
          RWF:
            type:
              - number
              - "null"
          SAR:
            type:
              - number
              - "null"
          SBD:
            type:
              - number
              - "null"
          SCR:
            type:
              - number
              - "null"
          SDG:
            type:
              - number
              - "null"
          SEK:
            type:
              - number
              - "null"
          SGD:
            type:
              - number
              - "null"
          SHP:
            type:
              - number
              - "null"
          SLE:
            type:
              - number
              - "null"
          SLL:
            type:
              - number
              - "null"
          SOS:
            type:
              - number
              - "null"
          SRD:
            type:
              - number
              - "null"
          STD:
            type:
              - number
              - "null"
          SVC:
            type:
              - number
              - "null"
          SYP:
            type:
              - number
              - "null"
          SZL:
            type:
              - number
              - "null"
          THB:
            type:
              - number
              - "null"
          TJS:
            type:
              - number
              - "null"
          TMT:
            type:
              - number
              - "null"
          TND:
            type:
              - number
              - "null"
          TOP:
            type:
              - number
              - "null"
          TRY:
            type:
              - number
              - "null"
          TTD:
            type:
              - number
              - "null"
          TWD:
            type:
              - number
              - "null"
          TZS:
            type:
              - number
              - "null"
          UAH:
            type:
              - number
              - "null"
          UGX:
            type:
              - number
              - "null"
          USD:
            type:
              - number
              - "null"
          UYU:
            type:
              - number
              - "null"
          UZS:
            type:
              - number
              - "null"
          VEF:
            type:
              - number
              - "null"
          VES:
            type:
              - number
              - "null"
          VND:
            type:
              - number
              - "null"
          VUV:
            type:
              - number
              - "null"
          WST:
            type:
              - number
              - "null"
          XAF:
            type:
              - number
              - "null"
          XAG:
            type:
              - number
              - "null"
          XAU:
            type:
              - number
              - "null"
          XCD:
            type:
              - number
              - "null"
          XDR:
            type:
              - number
              - "null"
          XOF:
            type:
              - number
              - "null"
          XPF:
            type:
              - number
              - "null"
          YER:
            type:
              - number
              - "null"
          ZAR:
            type:
              - number
              - "null"
          ZMK:
            type:
              - number
              - "null"
          ZMW:
            type:
              - number
              - "null"
          ZWL:
            type:
              - number
              - "null"
      success:
        type:
          - boolean
          - "null"
      timestamp:
        type:
          - number
          - "null"
    required:
      - date
