// Code generated by Speakeasy (https://speakeasy.com). DO NOT EDIT.

package provider

import (
	"context"
	"encoding/json"
	tfTypes "github.com/airbytehq/terraform-provider-airbyte/internal/provider/types"
	"github.com/airbytehq/terraform-provider-airbyte/internal/sdk/models/operations"
	"github.com/airbytehq/terraform-provider-airbyte/internal/sdk/models/shared"
	"github.com/hashicorp/terraform-plugin-framework-jsontypes/jsontypes"
	"github.com/hashicorp/terraform-plugin-framework/diag"
	"github.com/hashicorp/terraform-plugin-framework/types"
)

func (r *SourceResourceModel) RefreshFromSharedSourceResponse(ctx context.Context, resp *shared.SourceResponse) diag.Diagnostics {
	var diags diag.Diagnostics

	if resp != nil {
		configurationResult, _ := json.Marshal(resp.Configuration)
		r.Configuration = jsontypes.NewNormalizedValue(string(configurationResult))
		r.CreatedAt = types.Int64Value(resp.CreatedAt)
		r.DefinitionID = types.StringValue(resp.DefinitionID)
		r.Name = types.StringValue(resp.Name)
		if resp.ResourceAllocation == nil {
			r.ResourceAllocation = nil
		} else {
			r.ResourceAllocation = &tfTypes.ScopedResourceRequirements{}
			if resp.ResourceAllocation.Default == nil {
				r.ResourceAllocation.Default = nil
			} else {
				r.ResourceAllocation.Default = &tfTypes.ResourceRequirements{}
				r.ResourceAllocation.Default.CPULimit = types.StringPointerValue(resp.ResourceAllocation.Default.CPULimit)
				r.ResourceAllocation.Default.CPURequest = types.StringPointerValue(resp.ResourceAllocation.Default.CPURequest)
				r.ResourceAllocation.Default.EphemeralStorageLimit = types.StringPointerValue(resp.ResourceAllocation.Default.EphemeralStorageLimit)
				r.ResourceAllocation.Default.EphemeralStorageRequest = types.StringPointerValue(resp.ResourceAllocation.Default.EphemeralStorageRequest)
				r.ResourceAllocation.Default.MemoryLimit = types.StringPointerValue(resp.ResourceAllocation.Default.MemoryLimit)
				r.ResourceAllocation.Default.MemoryRequest = types.StringPointerValue(resp.ResourceAllocation.Default.MemoryRequest)
			}
			r.ResourceAllocation.JobSpecific = []tfTypes.JobTypeResourceLimit{}

			for _, jobSpecificItem := range resp.ResourceAllocation.JobSpecific {
				var jobSpecific tfTypes.JobTypeResourceLimit

				jobSpecific.JobType = types.StringValue(string(jobSpecificItem.JobType))
				jobSpecific.ResourceRequirements.CPULimit = types.StringPointerValue(jobSpecificItem.ResourceRequirements.CPULimit)
				jobSpecific.ResourceRequirements.CPURequest = types.StringPointerValue(jobSpecificItem.ResourceRequirements.CPURequest)
				jobSpecific.ResourceRequirements.EphemeralStorageLimit = types.StringPointerValue(jobSpecificItem.ResourceRequirements.EphemeralStorageLimit)
				jobSpecific.ResourceRequirements.EphemeralStorageRequest = types.StringPointerValue(jobSpecificItem.ResourceRequirements.EphemeralStorageRequest)
				jobSpecific.ResourceRequirements.MemoryLimit = types.StringPointerValue(jobSpecificItem.ResourceRequirements.MemoryLimit)
				jobSpecific.ResourceRequirements.MemoryRequest = types.StringPointerValue(jobSpecificItem.ResourceRequirements.MemoryRequest)

				r.ResourceAllocation.JobSpecific = append(r.ResourceAllocation.JobSpecific, jobSpecific)
			}
		}
		r.SourceID = types.StringValue(resp.SourceID)
		r.SourceType = types.StringValue(resp.SourceType)
		r.WorkspaceID = types.StringValue(resp.WorkspaceID)
	}

	return diags
}

func (r *SourceResourceModel) ToOperationsGetSourceRequest(ctx context.Context) (*operations.GetSourceRequest, diag.Diagnostics) {
	var diags diag.Diagnostics

	var sourceID string
	sourceID = r.SourceID.ValueString()

	out := operations.GetSourceRequest{
		SourceID: sourceID,
	}

	return &out, diags
}

func (r *SourceResourceModel) ToOperationsPutSourceRequest(ctx context.Context) (*operations.PutSourceRequest, diag.Diagnostics) {
	var diags diag.Diagnostics

	var sourceID string
	sourceID = r.SourceID.ValueString()

	sourcePutRequest, sourcePutRequestDiags := r.ToSharedSourcePutRequest(ctx)
	diags.Append(sourcePutRequestDiags...)

	if diags.HasError() {
		return nil, diags
	}

	out := operations.PutSourceRequest{
		SourceID:         sourceID,
		SourcePutRequest: sourcePutRequest,
	}

	return &out, diags
}

func (r *SourceResourceModel) ToSharedSourceCreateRequest(ctx context.Context) (*shared.SourceCreateRequest, diag.Diagnostics) {
	var diags diag.Diagnostics

	var name string
	name = r.Name.ValueString()

	definitionID := new(string)
	if !r.DefinitionID.IsUnknown() && !r.DefinitionID.IsNull() {
		*definitionID = r.DefinitionID.ValueString()
	} else {
		definitionID = nil
	}
	var workspaceID string
	workspaceID = r.WorkspaceID.ValueString()

	var configuration interface{}
	_ = json.Unmarshal([]byte(r.Configuration.ValueString()), &configuration)
	secretID := new(string)
	if !r.SecretID.IsUnknown() && !r.SecretID.IsNull() {
		*secretID = r.SecretID.ValueString()
	} else {
		secretID = nil
	}
	var resourceAllocation *shared.ScopedResourceRequirements
	if r.ResourceAllocation != nil {
		var defaultVar *shared.ResourceRequirements
		if r.ResourceAllocation.Default != nil {
			cpuRequest := new(string)
			if !r.ResourceAllocation.Default.CPURequest.IsUnknown() && !r.ResourceAllocation.Default.CPURequest.IsNull() {
				*cpuRequest = r.ResourceAllocation.Default.CPURequest.ValueString()
			} else {
				cpuRequest = nil
			}
			cpuLimit := new(string)
			if !r.ResourceAllocation.Default.CPULimit.IsUnknown() && !r.ResourceAllocation.Default.CPULimit.IsNull() {
				*cpuLimit = r.ResourceAllocation.Default.CPULimit.ValueString()
			} else {
				cpuLimit = nil
			}
			memoryRequest := new(string)
			if !r.ResourceAllocation.Default.MemoryRequest.IsUnknown() && !r.ResourceAllocation.Default.MemoryRequest.IsNull() {
				*memoryRequest = r.ResourceAllocation.Default.MemoryRequest.ValueString()
			} else {
				memoryRequest = nil
			}
			memoryLimit := new(string)
			if !r.ResourceAllocation.Default.MemoryLimit.IsUnknown() && !r.ResourceAllocation.Default.MemoryLimit.IsNull() {
				*memoryLimit = r.ResourceAllocation.Default.MemoryLimit.ValueString()
			} else {
				memoryLimit = nil
			}
			ephemeralStorageRequest := new(string)
			if !r.ResourceAllocation.Default.EphemeralStorageRequest.IsUnknown() && !r.ResourceAllocation.Default.EphemeralStorageRequest.IsNull() {
				*ephemeralStorageRequest = r.ResourceAllocation.Default.EphemeralStorageRequest.ValueString()
			} else {
				ephemeralStorageRequest = nil
			}
			ephemeralStorageLimit := new(string)
			if !r.ResourceAllocation.Default.EphemeralStorageLimit.IsUnknown() && !r.ResourceAllocation.Default.EphemeralStorageLimit.IsNull() {
				*ephemeralStorageLimit = r.ResourceAllocation.Default.EphemeralStorageLimit.ValueString()
			} else {
				ephemeralStorageLimit = nil
			}
			defaultVar = &shared.ResourceRequirements{
				CPURequest:              cpuRequest,
				CPULimit:                cpuLimit,
				MemoryRequest:           memoryRequest,
				MemoryLimit:             memoryLimit,
				EphemeralStorageRequest: ephemeralStorageRequest,
				EphemeralStorageLimit:   ephemeralStorageLimit,
			}
		}
		jobSpecific := make([]shared.JobTypeResourceLimit, 0, len(r.ResourceAllocation.JobSpecific))
		for jobSpecificIndex := range r.ResourceAllocation.JobSpecific {
			jobType := shared.JobType(r.ResourceAllocation.JobSpecific[jobSpecificIndex].JobType.ValueString())
			cpuRequest1 := new(string)
			if !r.ResourceAllocation.JobSpecific[jobSpecificIndex].ResourceRequirements.CPURequest.IsUnknown() && !r.ResourceAllocation.JobSpecific[jobSpecificIndex].ResourceRequirements.CPURequest.IsNull() {
				*cpuRequest1 = r.ResourceAllocation.JobSpecific[jobSpecificIndex].ResourceRequirements.CPURequest.ValueString()
			} else {
				cpuRequest1 = nil
			}
			cpuLimit1 := new(string)
			if !r.ResourceAllocation.JobSpecific[jobSpecificIndex].ResourceRequirements.CPULimit.IsUnknown() && !r.ResourceAllocation.JobSpecific[jobSpecificIndex].ResourceRequirements.CPULimit.IsNull() {
				*cpuLimit1 = r.ResourceAllocation.JobSpecific[jobSpecificIndex].ResourceRequirements.CPULimit.ValueString()
			} else {
				cpuLimit1 = nil
			}
			memoryRequest1 := new(string)
			if !r.ResourceAllocation.JobSpecific[jobSpecificIndex].ResourceRequirements.MemoryRequest.IsUnknown() && !r.ResourceAllocation.JobSpecific[jobSpecificIndex].ResourceRequirements.MemoryRequest.IsNull() {
				*memoryRequest1 = r.ResourceAllocation.JobSpecific[jobSpecificIndex].ResourceRequirements.MemoryRequest.ValueString()
			} else {
				memoryRequest1 = nil
			}
			memoryLimit1 := new(string)
			if !r.ResourceAllocation.JobSpecific[jobSpecificIndex].ResourceRequirements.MemoryLimit.IsUnknown() && !r.ResourceAllocation.JobSpecific[jobSpecificIndex].ResourceRequirements.MemoryLimit.IsNull() {
				*memoryLimit1 = r.ResourceAllocation.JobSpecific[jobSpecificIndex].ResourceRequirements.MemoryLimit.ValueString()
			} else {
				memoryLimit1 = nil
			}
			ephemeralStorageRequest1 := new(string)
			if !r.ResourceAllocation.JobSpecific[jobSpecificIndex].ResourceRequirements.EphemeralStorageRequest.IsUnknown() && !r.ResourceAllocation.JobSpecific[jobSpecificIndex].ResourceRequirements.EphemeralStorageRequest.IsNull() {
				*ephemeralStorageRequest1 = r.ResourceAllocation.JobSpecific[jobSpecificIndex].ResourceRequirements.EphemeralStorageRequest.ValueString()
			} else {
				ephemeralStorageRequest1 = nil
			}
			ephemeralStorageLimit1 := new(string)
			if !r.ResourceAllocation.JobSpecific[jobSpecificIndex].ResourceRequirements.EphemeralStorageLimit.IsUnknown() && !r.ResourceAllocation.JobSpecific[jobSpecificIndex].ResourceRequirements.EphemeralStorageLimit.IsNull() {
				*ephemeralStorageLimit1 = r.ResourceAllocation.JobSpecific[jobSpecificIndex].ResourceRequirements.EphemeralStorageLimit.ValueString()
			} else {
				ephemeralStorageLimit1 = nil
			}
			resourceRequirements := shared.ResourceRequirements{
				CPURequest:              cpuRequest1,
				CPULimit:                cpuLimit1,
				MemoryRequest:           memoryRequest1,
				MemoryLimit:             memoryLimit1,
				EphemeralStorageRequest: ephemeralStorageRequest1,
				EphemeralStorageLimit:   ephemeralStorageLimit1,
			}
			jobSpecific = append(jobSpecific, shared.JobTypeResourceLimit{
				JobType:              jobType,
				ResourceRequirements: resourceRequirements,
			})
		}
		resourceAllocation = &shared.ScopedResourceRequirements{
			Default:     defaultVar,
			JobSpecific: jobSpecific,
		}
	}
	out := shared.SourceCreateRequest{
		Name:               name,
		DefinitionID:       definitionID,
		WorkspaceID:        workspaceID,
		Configuration:      configuration,
		SecretID:           secretID,
		ResourceAllocation: resourceAllocation,
	}

	return &out, diags
}

func (r *SourceResourceModel) ToSharedSourcePutRequest(ctx context.Context) (*shared.SourcePutRequest, diag.Diagnostics) {
	var diags diag.Diagnostics

	var name string
	name = r.Name.ValueString()

	var configuration interface{}
	_ = json.Unmarshal([]byte(r.Configuration.ValueString()), &configuration)
	var resourceAllocation *shared.ScopedResourceRequirements
	if r.ResourceAllocation != nil {
		var defaultVar *shared.ResourceRequirements
		if r.ResourceAllocation.Default != nil {
			cpuRequest := new(string)
			if !r.ResourceAllocation.Default.CPURequest.IsUnknown() && !r.ResourceAllocation.Default.CPURequest.IsNull() {
				*cpuRequest = r.ResourceAllocation.Default.CPURequest.ValueString()
			} else {
				cpuRequest = nil
			}
			cpuLimit := new(string)
			if !r.ResourceAllocation.Default.CPULimit.IsUnknown() && !r.ResourceAllocation.Default.CPULimit.IsNull() {
				*cpuLimit = r.ResourceAllocation.Default.CPULimit.ValueString()
			} else {
				cpuLimit = nil
			}
			memoryRequest := new(string)
			if !r.ResourceAllocation.Default.MemoryRequest.IsUnknown() && !r.ResourceAllocation.Default.MemoryRequest.IsNull() {
				*memoryRequest = r.ResourceAllocation.Default.MemoryRequest.ValueString()
			} else {
				memoryRequest = nil
			}
			memoryLimit := new(string)
			if !r.ResourceAllocation.Default.MemoryLimit.IsUnknown() && !r.ResourceAllocation.Default.MemoryLimit.IsNull() {
				*memoryLimit = r.ResourceAllocation.Default.MemoryLimit.ValueString()
			} else {
				memoryLimit = nil
			}
			ephemeralStorageRequest := new(string)
			if !r.ResourceAllocation.Default.EphemeralStorageRequest.IsUnknown() && !r.ResourceAllocation.Default.EphemeralStorageRequest.IsNull() {
				*ephemeralStorageRequest = r.ResourceAllocation.Default.EphemeralStorageRequest.ValueString()
			} else {
				ephemeralStorageRequest = nil
			}
			ephemeralStorageLimit := new(string)
			if !r.ResourceAllocation.Default.EphemeralStorageLimit.IsUnknown() && !r.ResourceAllocation.Default.EphemeralStorageLimit.IsNull() {
				*ephemeralStorageLimit = r.ResourceAllocation.Default.EphemeralStorageLimit.ValueString()
			} else {
				ephemeralStorageLimit = nil
			}
			defaultVar = &shared.ResourceRequirements{
				CPURequest:              cpuRequest,
				CPULimit:                cpuLimit,
				MemoryRequest:           memoryRequest,
				MemoryLimit:             memoryLimit,
				EphemeralStorageRequest: ephemeralStorageRequest,
				EphemeralStorageLimit:   ephemeralStorageLimit,
			}
		}
		jobSpecific := make([]shared.JobTypeResourceLimit, 0, len(r.ResourceAllocation.JobSpecific))
		for jobSpecificIndex := range r.ResourceAllocation.JobSpecific {
			jobType := shared.JobType(r.ResourceAllocation.JobSpecific[jobSpecificIndex].JobType.ValueString())
			cpuRequest1 := new(string)
			if !r.ResourceAllocation.JobSpecific[jobSpecificIndex].ResourceRequirements.CPURequest.IsUnknown() && !r.ResourceAllocation.JobSpecific[jobSpecificIndex].ResourceRequirements.CPURequest.IsNull() {
				*cpuRequest1 = r.ResourceAllocation.JobSpecific[jobSpecificIndex].ResourceRequirements.CPURequest.ValueString()
			} else {
				cpuRequest1 = nil
			}
			cpuLimit1 := new(string)
			if !r.ResourceAllocation.JobSpecific[jobSpecificIndex].ResourceRequirements.CPULimit.IsUnknown() && !r.ResourceAllocation.JobSpecific[jobSpecificIndex].ResourceRequirements.CPULimit.IsNull() {
				*cpuLimit1 = r.ResourceAllocation.JobSpecific[jobSpecificIndex].ResourceRequirements.CPULimit.ValueString()
			} else {
				cpuLimit1 = nil
			}
			memoryRequest1 := new(string)
			if !r.ResourceAllocation.JobSpecific[jobSpecificIndex].ResourceRequirements.MemoryRequest.IsUnknown() && !r.ResourceAllocation.JobSpecific[jobSpecificIndex].ResourceRequirements.MemoryRequest.IsNull() {
				*memoryRequest1 = r.ResourceAllocation.JobSpecific[jobSpecificIndex].ResourceRequirements.MemoryRequest.ValueString()
			} else {
				memoryRequest1 = nil
			}
			memoryLimit1 := new(string)
			if !r.ResourceAllocation.JobSpecific[jobSpecificIndex].ResourceRequirements.MemoryLimit.IsUnknown() && !r.ResourceAllocation.JobSpecific[jobSpecificIndex].ResourceRequirements.MemoryLimit.IsNull() {
				*memoryLimit1 = r.ResourceAllocation.JobSpecific[jobSpecificIndex].ResourceRequirements.MemoryLimit.ValueString()
			} else {
				memoryLimit1 = nil
			}
			ephemeralStorageRequest1 := new(string)
			if !r.ResourceAllocation.JobSpecific[jobSpecificIndex].ResourceRequirements.EphemeralStorageRequest.IsUnknown() && !r.ResourceAllocation.JobSpecific[jobSpecificIndex].ResourceRequirements.EphemeralStorageRequest.IsNull() {
				*ephemeralStorageRequest1 = r.ResourceAllocation.JobSpecific[jobSpecificIndex].ResourceRequirements.EphemeralStorageRequest.ValueString()
			} else {
				ephemeralStorageRequest1 = nil
			}
			ephemeralStorageLimit1 := new(string)
			if !r.ResourceAllocation.JobSpecific[jobSpecificIndex].ResourceRequirements.EphemeralStorageLimit.IsUnknown() && !r.ResourceAllocation.JobSpecific[jobSpecificIndex].ResourceRequirements.EphemeralStorageLimit.IsNull() {
				*ephemeralStorageLimit1 = r.ResourceAllocation.JobSpecific[jobSpecificIndex].ResourceRequirements.EphemeralStorageLimit.ValueString()
			} else {
				ephemeralStorageLimit1 = nil
			}
			resourceRequirements := shared.ResourceRequirements{
				CPURequest:              cpuRequest1,
				CPULimit:                cpuLimit1,
				MemoryRequest:           memoryRequest1,
				MemoryLimit:             memoryLimit1,
				EphemeralStorageRequest: ephemeralStorageRequest1,
				EphemeralStorageLimit:   ephemeralStorageLimit1,
			}
			jobSpecific = append(jobSpecific, shared.JobTypeResourceLimit{
				JobType:              jobType,
				ResourceRequirements: resourceRequirements,
			})
		}
		resourceAllocation = &shared.ScopedResourceRequirements{
			Default:     defaultVar,
			JobSpecific: jobSpecific,
		}
	}
	out := shared.SourcePutRequest{
		Name:               name,
		Configuration:      configuration,
		ResourceAllocation: resourceAllocation,
	}

	return &out, diags
}
