// Code generated by Speakeasy (https://speakeasy.com). DO NOT EDIT.

package provider

import (
	"context"
	"encoding/json"
	tfTypes "github.com/airbytehq/terraform-provider-airbyte/internal/provider/types"
	"github.com/airbytehq/terraform-provider-airbyte/internal/sdk/models/operations"
	"github.com/airbytehq/terraform-provider-airbyte/internal/sdk/models/shared"
	"github.com/hashicorp/terraform-plugin-framework-jsontypes/jsontypes"
	"github.com/hashicorp/terraform-plugin-framework/diag"
	"github.com/hashicorp/terraform-plugin-framework/types"
)

func (r *ConnectionResourceModel) RefreshFromSharedConnectionResponse(ctx context.Context, resp *shared.ConnectionResponse) diag.Diagnostics {
	var diags diag.Diagnostics

	if resp != nil {
		if r.Configurations == nil {
			r.Configurations = &tfTypes.StreamConfigurations{}

			r.Configurations.Streams = []tfTypes.StreamConfiguration{}

			for _, streamsItem := range resp.Configurations.Streams {
				var streams tfTypes.StreamConfiguration

				streams.CursorField = make([]types.String, 0, len(streamsItem.CursorField))
				for _, v := range streamsItem.CursorField {
					streams.CursorField = append(streams.CursorField, types.StringValue(v))
				}
				streams.DestinationObjectName = types.StringPointerValue(streamsItem.DestinationObjectName)
				streams.IncludeFiles = types.BoolPointerValue(streamsItem.IncludeFiles)
				streams.Mappers = []tfTypes.ConfiguredStreamMapper{}

				for _, mappersItem := range streamsItem.Mappers {
					var mappers tfTypes.ConfiguredStreamMapper

					mappers.ID = types.StringPointerValue(mappersItem.ID)
					if mappersItem.MapperConfiguration.Encryption != nil {
						mappers.MapperConfiguration.Encryption = &tfTypes.Encryption{}
						if mappersItem.MapperConfiguration.Encryption.EncryptionMapperAESConfiguration != nil {
							mappers.MapperConfiguration.Encryption.Aes = &tfTypes.EncryptionMapperAESConfiguration{}
							mappers.MapperConfiguration.Encryption.Aes.Algorithm = types.StringValue(string(mappersItem.MapperConfiguration.Encryption.EncryptionMapperAESConfiguration.Algorithm))
							mappers.MapperConfiguration.Encryption.Aes.FieldNameSuffix = types.StringValue(mappersItem.MapperConfiguration.Encryption.EncryptionMapperAESConfiguration.FieldNameSuffix)
							mappers.MapperConfiguration.Encryption.Aes.Key = types.StringValue(mappersItem.MapperConfiguration.Encryption.EncryptionMapperAESConfiguration.Key)
							mappers.MapperConfiguration.Encryption.Aes.Mode = types.StringValue(string(mappersItem.MapperConfiguration.Encryption.EncryptionMapperAESConfiguration.Mode))
							mappers.MapperConfiguration.Encryption.Aes.Padding = types.StringValue(string(mappersItem.MapperConfiguration.Encryption.EncryptionMapperAESConfiguration.Padding))
							mappers.MapperConfiguration.Encryption.Aes.TargetField = types.StringValue(mappersItem.MapperConfiguration.Encryption.EncryptionMapperAESConfiguration.TargetField)
						}
						if mappersItem.MapperConfiguration.Encryption.EncryptionMapperRSAConfiguration != nil {
							mappers.MapperConfiguration.Encryption.Rsa = &tfTypes.EncryptionMapperRSAConfiguration{}
							mappers.MapperConfiguration.Encryption.Rsa.Algorithm = types.StringValue(string(mappersItem.MapperConfiguration.Encryption.EncryptionMapperRSAConfiguration.Algorithm))
							mappers.MapperConfiguration.Encryption.Rsa.FieldNameSuffix = types.StringValue(mappersItem.MapperConfiguration.Encryption.EncryptionMapperRSAConfiguration.FieldNameSuffix)
							mappers.MapperConfiguration.Encryption.Rsa.PublicKey = types.StringValue(mappersItem.MapperConfiguration.Encryption.EncryptionMapperRSAConfiguration.PublicKey)
							mappers.MapperConfiguration.Encryption.Rsa.TargetField = types.StringValue(mappersItem.MapperConfiguration.Encryption.EncryptionMapperRSAConfiguration.TargetField)
						}
					}
					if mappersItem.MapperConfiguration.FieldFiltering != nil {
						mappers.MapperConfiguration.FieldFiltering = &tfTypes.FieldFiltering{}
						mappers.MapperConfiguration.FieldFiltering.TargetField = types.StringValue(mappersItem.MapperConfiguration.FieldFiltering.TargetField)
					}
					if mappersItem.MapperConfiguration.FieldRenaming != nil {
						mappers.MapperConfiguration.FieldRenaming = &tfTypes.FieldRenaming{}
						mappers.MapperConfiguration.FieldRenaming.NewFieldName = types.StringValue(mappersItem.MapperConfiguration.FieldRenaming.NewFieldName)
						mappers.MapperConfiguration.FieldRenaming.OriginalFieldName = types.StringValue(mappersItem.MapperConfiguration.FieldRenaming.OriginalFieldName)
					}
					if mappersItem.MapperConfiguration.Hashing != nil {
						mappers.MapperConfiguration.Hashing = &tfTypes.Hashing{}
						mappers.MapperConfiguration.Hashing.FieldNameSuffix = types.StringValue(mappersItem.MapperConfiguration.Hashing.FieldNameSuffix)
						mappers.MapperConfiguration.Hashing.Method = types.StringValue(string(mappersItem.MapperConfiguration.Hashing.Method))
						mappers.MapperConfiguration.Hashing.TargetField = types.StringValue(mappersItem.MapperConfiguration.Hashing.TargetField)
					}
					if mappersItem.MapperConfiguration.RowFiltering != nil {
						mappers.MapperConfiguration.RowFiltering = &tfTypes.RowFiltering{}
						conditionsResult, _ := json.Marshal(mappersItem.MapperConfiguration.RowFiltering.Conditions)
						mappers.MapperConfiguration.RowFiltering.Conditions = jsontypes.NewNormalizedValue(string(conditionsResult))
					}
					mappers.Type = types.StringValue(string(mappersItem.Type))

					streams.Mappers = append(streams.Mappers, mappers)
				}
				streams.Name = types.StringValue(streamsItem.Name)
				streams.Namespace = types.StringPointerValue(streamsItem.Namespace)
				streams.PrimaryKey = nil
				for _, primaryKeyItem := range streamsItem.PrimaryKey {
					var primaryKey []types.String
					primaryKey = make([]types.String, 0, len(primaryKeyItem))
					for _, v := range primaryKeyItem {
						primaryKey = append(primaryKey, types.StringValue(v))
					}
					streams.PrimaryKey = append(streams.PrimaryKey, primaryKey)
				}
				streams.SelectedFields = []tfTypes.SelectedFieldInfo{}

				for _, selectedFieldsItem := range streamsItem.SelectedFields {
					var selectedFields tfTypes.SelectedFieldInfo

					selectedFields.FieldPath = make([]types.String, 0, len(selectedFieldsItem.FieldPath))
					for _, v := range selectedFieldsItem.FieldPath {
						selectedFields.FieldPath = append(selectedFields.FieldPath, types.StringValue(v))
					}

					streams.SelectedFields = append(streams.SelectedFields, selectedFields)
				}
				if streamsItem.SyncMode != nil {
					streams.SyncMode = types.StringValue(string(*streamsItem.SyncMode))
				} else {
					streams.SyncMode = types.StringNull()
				}

				r.Configurations.Streams = append(r.Configurations.Streams, streams)
			}
		}
		r.ConnectionID = types.StringValue(resp.ConnectionID)
		r.CreatedAt = types.Int64Value(resp.CreatedAt)
		r.DestinationID = types.StringValue(resp.DestinationID)
		r.Name = types.StringValue(resp.Name)
		if resp.NamespaceDefinition != nil {
			r.NamespaceDefinition = types.StringValue(string(*resp.NamespaceDefinition))
		} else {
			r.NamespaceDefinition = types.StringNull()
		}
		r.NamespaceFormat = types.StringPointerValue(resp.NamespaceFormat)
		if resp.NonBreakingSchemaUpdatesBehavior != nil {
			r.NonBreakingSchemaUpdatesBehavior = types.StringValue(string(*resp.NonBreakingSchemaUpdatesBehavior))
		} else {
			r.NonBreakingSchemaUpdatesBehavior = types.StringNull()
		}
		r.Prefix = types.StringPointerValue(resp.Prefix)
		if r.Schedule == nil {
			r.Schedule = &tfTypes.AirbyteAPIConnectionSchedule{}
		}
		r.Schedule.BasicTiming = types.StringPointerValue(resp.Schedule.BasicTiming)
		r.Schedule.CronExpression = types.StringPointerValue(resp.Schedule.CronExpression)
		r.Schedule.ScheduleType = types.StringValue(string(resp.Schedule.ScheduleType))
		r.SourceID = types.StringValue(resp.SourceID)
		r.Status = types.StringValue(string(resp.Status))
		r.StatusReason = types.StringPointerValue(resp.StatusReason)
		r.Tags = []tfTypes.Tag{}

		for _, tagsItem := range resp.Tags {
			var tags tfTypes.Tag

			tags.Color = types.StringValue(tagsItem.Color)
			tags.Name = types.StringValue(tagsItem.Name)
			tags.TagID = types.StringValue(tagsItem.TagID)
			tags.WorkspaceID = types.StringValue(tagsItem.WorkspaceID)

			r.Tags = append(r.Tags, tags)
		}
		r.WorkspaceID = types.StringValue(resp.WorkspaceID)
	}

	return diags
}

func (r *ConnectionResourceModel) ToOperationsDeleteConnectionRequest(ctx context.Context) (*operations.DeleteConnectionRequest, diag.Diagnostics) {
	var diags diag.Diagnostics

	var connectionID string
	connectionID = r.ConnectionID.ValueString()

	out := operations.DeleteConnectionRequest{
		ConnectionID: connectionID,
	}

	return &out, diags
}

func (r *ConnectionResourceModel) ToOperationsGetConnectionRequest(ctx context.Context) (*operations.GetConnectionRequest, diag.Diagnostics) {
	var diags diag.Diagnostics

	var connectionID string
	connectionID = r.ConnectionID.ValueString()

	out := operations.GetConnectionRequest{
		ConnectionID: connectionID,
	}

	return &out, diags
}

func (r *ConnectionResourceModel) ToOperationsPatchConnectionRequest(ctx context.Context) (*operations.PatchConnectionRequest, diag.Diagnostics) {
	var diags diag.Diagnostics

	var connectionID string
	connectionID = r.ConnectionID.ValueString()

	connectionPatchRequest, connectionPatchRequestDiags := r.ToSharedConnectionPatchRequest(ctx)
	diags.Append(connectionPatchRequestDiags...)

	if diags.HasError() {
		return nil, diags
	}

	out := operations.PatchConnectionRequest{
		ConnectionID:           connectionID,
		ConnectionPatchRequest: *connectionPatchRequest,
	}

	return &out, diags
}

func (r *ConnectionResourceModel) ToSharedConnectionCreateRequest(ctx context.Context) (*shared.ConnectionCreateRequest, diag.Diagnostics) {
	var diags diag.Diagnostics

	name := new(string)
	if !r.Name.IsUnknown() && !r.Name.IsNull() {
		*name = r.Name.ValueString()
	} else {
		name = nil
	}
	var sourceID string
	sourceID = r.SourceID.ValueString()

	var destinationID string
	destinationID = r.DestinationID.ValueString()

	var configurations *shared.StreamConfigurations
	if r.Configurations != nil {
		streams := make([]shared.StreamConfiguration, 0, len(r.Configurations.Streams))
		for streamsIndex := range r.Configurations.Streams {
			var name1 string
			name1 = r.Configurations.Streams[streamsIndex].Name.ValueString()

			namespace := new(string)
			if !r.Configurations.Streams[streamsIndex].Namespace.IsUnknown() && !r.Configurations.Streams[streamsIndex].Namespace.IsNull() {
				*namespace = r.Configurations.Streams[streamsIndex].Namespace.ValueString()
			} else {
				namespace = nil
			}
			syncMode := new(shared.ConnectionSyncModeEnum)
			if !r.Configurations.Streams[streamsIndex].SyncMode.IsUnknown() && !r.Configurations.Streams[streamsIndex].SyncMode.IsNull() {
				*syncMode = shared.ConnectionSyncModeEnum(r.Configurations.Streams[streamsIndex].SyncMode.ValueString())
			} else {
				syncMode = nil
			}
			cursorField := make([]string, 0, len(r.Configurations.Streams[streamsIndex].CursorField))
			for cursorFieldIndex := range r.Configurations.Streams[streamsIndex].CursorField {
				cursorField = append(cursorField, r.Configurations.Streams[streamsIndex].CursorField[cursorFieldIndex].ValueString())
			}
			primaryKey := make([][]string, 0, len(r.Configurations.Streams[streamsIndex].PrimaryKey))
			for primaryKeyIndex := range r.Configurations.Streams[streamsIndex].PrimaryKey {
				primaryKeyTmp := make([]string, 0, len(r.Configurations.Streams[streamsIndex].PrimaryKey[primaryKeyIndex]))
				for index := range r.Configurations.Streams[streamsIndex].PrimaryKey[primaryKeyIndex] {
					primaryKeyTmp = append(primaryKeyTmp, r.Configurations.Streams[streamsIndex].PrimaryKey[primaryKeyIndex][index].ValueString())
				}
				primaryKey = append(primaryKey, primaryKeyTmp)
			}
			includeFiles := new(bool)
			if !r.Configurations.Streams[streamsIndex].IncludeFiles.IsUnknown() && !r.Configurations.Streams[streamsIndex].IncludeFiles.IsNull() {
				*includeFiles = r.Configurations.Streams[streamsIndex].IncludeFiles.ValueBool()
			} else {
				includeFiles = nil
			}
			destinationObjectName := new(string)
			if !r.Configurations.Streams[streamsIndex].DestinationObjectName.IsUnknown() && !r.Configurations.Streams[streamsIndex].DestinationObjectName.IsNull() {
				*destinationObjectName = r.Configurations.Streams[streamsIndex].DestinationObjectName.ValueString()
			} else {
				destinationObjectName = nil
			}
			selectedFields := make([]shared.SelectedFieldInfo, 0, len(r.Configurations.Streams[streamsIndex].SelectedFields))
			for selectedFieldsIndex := range r.Configurations.Streams[streamsIndex].SelectedFields {
				fieldPath := make([]string, 0, len(r.Configurations.Streams[streamsIndex].SelectedFields[selectedFieldsIndex].FieldPath))
				for fieldPathIndex := range r.Configurations.Streams[streamsIndex].SelectedFields[selectedFieldsIndex].FieldPath {
					fieldPath = append(fieldPath, r.Configurations.Streams[streamsIndex].SelectedFields[selectedFieldsIndex].FieldPath[fieldPathIndex].ValueString())
				}
				selectedFields = append(selectedFields, shared.SelectedFieldInfo{
					FieldPath: fieldPath,
				})
			}
			mappers := make([]shared.ConfiguredStreamMapper, 0, len(r.Configurations.Streams[streamsIndex].Mappers))
			for mappersIndex := range r.Configurations.Streams[streamsIndex].Mappers {
				id := new(string)
				if !r.Configurations.Streams[streamsIndex].Mappers[mappersIndex].ID.IsUnknown() && !r.Configurations.Streams[streamsIndex].Mappers[mappersIndex].ID.IsNull() {
					*id = r.Configurations.Streams[streamsIndex].Mappers[mappersIndex].ID.ValueString()
				} else {
					id = nil
				}
				typeVar := shared.StreamMapperType(r.Configurations.Streams[streamsIndex].Mappers[mappersIndex].Type.ValueString())
				var mapperConfiguration shared.MapperConfiguration
				var hashing *shared.Hashing
				if r.Configurations.Streams[streamsIndex].Mappers[mappersIndex].MapperConfiguration.Hashing != nil {
					var fieldNameSuffix string
					fieldNameSuffix = r.Configurations.Streams[streamsIndex].Mappers[mappersIndex].MapperConfiguration.Hashing.FieldNameSuffix.ValueString()

					method := shared.HashingMethod(r.Configurations.Streams[streamsIndex].Mappers[mappersIndex].MapperConfiguration.Hashing.Method.ValueString())
					var targetField string
					targetField = r.Configurations.Streams[streamsIndex].Mappers[mappersIndex].MapperConfiguration.Hashing.TargetField.ValueString()

					hashing = &shared.Hashing{
						FieldNameSuffix: fieldNameSuffix,
						Method:          method,
						TargetField:     targetField,
					}
				}
				if hashing != nil {
					mapperConfiguration = shared.MapperConfiguration{
						Hashing: hashing,
					}
				}
				var fieldFiltering *shared.FieldFiltering
				if r.Configurations.Streams[streamsIndex].Mappers[mappersIndex].MapperConfiguration.FieldFiltering != nil {
					var targetField1 string
					targetField1 = r.Configurations.Streams[streamsIndex].Mappers[mappersIndex].MapperConfiguration.FieldFiltering.TargetField.ValueString()

					fieldFiltering = &shared.FieldFiltering{
						TargetField: targetField1,
					}
				}
				if fieldFiltering != nil {
					mapperConfiguration = shared.MapperConfiguration{
						FieldFiltering: fieldFiltering,
					}
				}
				var fieldRenaming *shared.FieldRenaming
				if r.Configurations.Streams[streamsIndex].Mappers[mappersIndex].MapperConfiguration.FieldRenaming != nil {
					var newFieldName string
					newFieldName = r.Configurations.Streams[streamsIndex].Mappers[mappersIndex].MapperConfiguration.FieldRenaming.NewFieldName.ValueString()

					var originalFieldName string
					originalFieldName = r.Configurations.Streams[streamsIndex].Mappers[mappersIndex].MapperConfiguration.FieldRenaming.OriginalFieldName.ValueString()

					fieldRenaming = &shared.FieldRenaming{
						NewFieldName:      newFieldName,
						OriginalFieldName: originalFieldName,
					}
				}
				if fieldRenaming != nil {
					mapperConfiguration = shared.MapperConfiguration{
						FieldRenaming: fieldRenaming,
					}
				}
				var rowFiltering *shared.RowFiltering
				if r.Configurations.Streams[streamsIndex].Mappers[mappersIndex].MapperConfiguration.RowFiltering != nil {
					var conditions interface{}
					_ = json.Unmarshal([]byte(r.Configurations.Streams[streamsIndex].Mappers[mappersIndex].MapperConfiguration.RowFiltering.Conditions.ValueString()), &conditions)
					rowFiltering = &shared.RowFiltering{
						Conditions: conditions,
					}
				}
				if rowFiltering != nil {
					mapperConfiguration = shared.MapperConfiguration{
						RowFiltering: rowFiltering,
					}
				}
				var encryption *shared.Encryption
				if r.Configurations.Streams[streamsIndex].Mappers[mappersIndex].MapperConfiguration.Encryption != nil {
					var encryptionMapperRSAConfiguration *shared.EncryptionMapperRSAConfiguration
					if r.Configurations.Streams[streamsIndex].Mappers[mappersIndex].MapperConfiguration.Encryption.Rsa != nil {
						algorithm := shared.EncryptionMapperAlgorithm(r.Configurations.Streams[streamsIndex].Mappers[mappersIndex].MapperConfiguration.Encryption.Rsa.Algorithm.ValueString())
						var fieldNameSuffix1 string
						fieldNameSuffix1 = r.Configurations.Streams[streamsIndex].Mappers[mappersIndex].MapperConfiguration.Encryption.Rsa.FieldNameSuffix.ValueString()

						var publicKey string
						publicKey = r.Configurations.Streams[streamsIndex].Mappers[mappersIndex].MapperConfiguration.Encryption.Rsa.PublicKey.ValueString()

						var targetField2 string
						targetField2 = r.Configurations.Streams[streamsIndex].Mappers[mappersIndex].MapperConfiguration.Encryption.Rsa.TargetField.ValueString()

						encryptionMapperRSAConfiguration = &shared.EncryptionMapperRSAConfiguration{
							Algorithm:       algorithm,
							FieldNameSuffix: fieldNameSuffix1,
							PublicKey:       publicKey,
							TargetField:     targetField2,
						}
					}
					if encryptionMapperRSAConfiguration != nil {
						encryption = &shared.Encryption{
							EncryptionMapperRSAConfiguration: encryptionMapperRSAConfiguration,
						}
					}
					var encryptionMapperAESConfiguration *shared.EncryptionMapperAESConfiguration
					if r.Configurations.Streams[streamsIndex].Mappers[mappersIndex].MapperConfiguration.Encryption.Aes != nil {
						algorithm1 := shared.EncryptionMapperAlgorithm(r.Configurations.Streams[streamsIndex].Mappers[mappersIndex].MapperConfiguration.Encryption.Aes.Algorithm.ValueString())
						var fieldNameSuffix2 string
						fieldNameSuffix2 = r.Configurations.Streams[streamsIndex].Mappers[mappersIndex].MapperConfiguration.Encryption.Aes.FieldNameSuffix.ValueString()

						var key string
						key = r.Configurations.Streams[streamsIndex].Mappers[mappersIndex].MapperConfiguration.Encryption.Aes.Key.ValueString()

						mode := shared.Mode(r.Configurations.Streams[streamsIndex].Mappers[mappersIndex].MapperConfiguration.Encryption.Aes.Mode.ValueString())
						padding := shared.Padding(r.Configurations.Streams[streamsIndex].Mappers[mappersIndex].MapperConfiguration.Encryption.Aes.Padding.ValueString())
						var targetField3 string
						targetField3 = r.Configurations.Streams[streamsIndex].Mappers[mappersIndex].MapperConfiguration.Encryption.Aes.TargetField.ValueString()

						encryptionMapperAESConfiguration = &shared.EncryptionMapperAESConfiguration{
							Algorithm:       algorithm1,
							FieldNameSuffix: fieldNameSuffix2,
							Key:             key,
							Mode:            mode,
							Padding:         padding,
							TargetField:     targetField3,
						}
					}
					if encryptionMapperAESConfiguration != nil {
						encryption = &shared.Encryption{
							EncryptionMapperAESConfiguration: encryptionMapperAESConfiguration,
						}
					}
				}
				if encryption != nil {
					mapperConfiguration = shared.MapperConfiguration{
						Encryption: encryption,
					}
				}
				mappers = append(mappers, shared.ConfiguredStreamMapper{
					ID:                  id,
					Type:                typeVar,
					MapperConfiguration: mapperConfiguration,
				})
			}
			streams = append(streams, shared.StreamConfiguration{
				Name:                  name1,
				Namespace:             namespace,
				SyncMode:              syncMode,
				CursorField:           cursorField,
				PrimaryKey:            primaryKey,
				IncludeFiles:          includeFiles,
				DestinationObjectName: destinationObjectName,
				SelectedFields:        selectedFields,
				Mappers:               mappers,
			})
		}
		configurations = &shared.StreamConfigurations{
			Streams: streams,
		}
	}
	var schedule *shared.AirbyteAPIConnectionSchedule
	if r.Schedule != nil {
		scheduleType := shared.ScheduleTypeEnum(r.Schedule.ScheduleType.ValueString())
		cronExpression := new(string)
		if !r.Schedule.CronExpression.IsUnknown() && !r.Schedule.CronExpression.IsNull() {
			*cronExpression = r.Schedule.CronExpression.ValueString()
		} else {
			cronExpression = nil
		}
		schedule = &shared.AirbyteAPIConnectionSchedule{
			ScheduleType:   scheduleType,
			CronExpression: cronExpression,
		}
	}
	dataResidency := new(string)
	if !r.DataResidency.IsUnknown() && !r.DataResidency.IsNull() {
		*dataResidency = r.DataResidency.ValueString()
	} else {
		dataResidency = nil
	}
	namespaceDefinition := new(shared.NamespaceDefinitionEnum)
	if !r.NamespaceDefinition.IsUnknown() && !r.NamespaceDefinition.IsNull() {
		*namespaceDefinition = shared.NamespaceDefinitionEnum(r.NamespaceDefinition.ValueString())
	} else {
		namespaceDefinition = nil
	}
	namespaceFormat := new(string)
	if !r.NamespaceFormat.IsUnknown() && !r.NamespaceFormat.IsNull() {
		*namespaceFormat = r.NamespaceFormat.ValueString()
	} else {
		namespaceFormat = nil
	}
	prefix := new(string)
	if !r.Prefix.IsUnknown() && !r.Prefix.IsNull() {
		*prefix = r.Prefix.ValueString()
	} else {
		prefix = nil
	}
	nonBreakingSchemaUpdatesBehavior := new(shared.NonBreakingSchemaUpdatesBehaviorEnum)
	if !r.NonBreakingSchemaUpdatesBehavior.IsUnknown() && !r.NonBreakingSchemaUpdatesBehavior.IsNull() {
		*nonBreakingSchemaUpdatesBehavior = shared.NonBreakingSchemaUpdatesBehaviorEnum(r.NonBreakingSchemaUpdatesBehavior.ValueString())
	} else {
		nonBreakingSchemaUpdatesBehavior = nil
	}
	status := new(shared.ConnectionStatusEnum)
	if !r.Status.IsUnknown() && !r.Status.IsNull() {
		*status = shared.ConnectionStatusEnum(r.Status.ValueString())
	} else {
		status = nil
	}
	tags := make([]shared.Tag, 0, len(r.Tags))
	for tagsIndex := range r.Tags {
		var tagID string
		tagID = r.Tags[tagsIndex].TagID.ValueString()

		var workspaceID string
		workspaceID = r.Tags[tagsIndex].WorkspaceID.ValueString()

		var name2 string
		name2 = r.Tags[tagsIndex].Name.ValueString()

		var color string
		color = r.Tags[tagsIndex].Color.ValueString()

		tags = append(tags, shared.Tag{
			TagID:       tagID,
			WorkspaceID: workspaceID,
			Name:        name2,
			Color:       color,
		})
	}
	out := shared.ConnectionCreateRequest{
		Name:                             name,
		SourceID:                         sourceID,
		DestinationID:                    destinationID,
		Configurations:                   configurations,
		Schedule:                         schedule,
		DataResidency:                    dataResidency,
		NamespaceDefinition:              namespaceDefinition,
		NamespaceFormat:                  namespaceFormat,
		Prefix:                           prefix,
		NonBreakingSchemaUpdatesBehavior: nonBreakingSchemaUpdatesBehavior,
		Status:                           status,
		Tags:                             tags,
	}

	return &out, diags
}

func (r *ConnectionResourceModel) ToSharedConnectionPatchRequest(ctx context.Context) (*shared.ConnectionPatchRequest, diag.Diagnostics) {
	var diags diag.Diagnostics

	name := new(string)
	if !r.Name.IsUnknown() && !r.Name.IsNull() {
		*name = r.Name.ValueString()
	} else {
		name = nil
	}
	var configurations *shared.StreamConfigurations
	if r.Configurations != nil {
		streams := make([]shared.StreamConfiguration, 0, len(r.Configurations.Streams))
		for streamsIndex := range r.Configurations.Streams {
			var name1 string
			name1 = r.Configurations.Streams[streamsIndex].Name.ValueString()

			namespace := new(string)
			if !r.Configurations.Streams[streamsIndex].Namespace.IsUnknown() && !r.Configurations.Streams[streamsIndex].Namespace.IsNull() {
				*namespace = r.Configurations.Streams[streamsIndex].Namespace.ValueString()
			} else {
				namespace = nil
			}
			syncMode := new(shared.ConnectionSyncModeEnum)
			if !r.Configurations.Streams[streamsIndex].SyncMode.IsUnknown() && !r.Configurations.Streams[streamsIndex].SyncMode.IsNull() {
				*syncMode = shared.ConnectionSyncModeEnum(r.Configurations.Streams[streamsIndex].SyncMode.ValueString())
			} else {
				syncMode = nil
			}
			cursorField := make([]string, 0, len(r.Configurations.Streams[streamsIndex].CursorField))
			for cursorFieldIndex := range r.Configurations.Streams[streamsIndex].CursorField {
				cursorField = append(cursorField, r.Configurations.Streams[streamsIndex].CursorField[cursorFieldIndex].ValueString())
			}
			primaryKey := make([][]string, 0, len(r.Configurations.Streams[streamsIndex].PrimaryKey))
			for primaryKeyIndex := range r.Configurations.Streams[streamsIndex].PrimaryKey {
				primaryKeyTmp := make([]string, 0, len(r.Configurations.Streams[streamsIndex].PrimaryKey[primaryKeyIndex]))
				for index := range r.Configurations.Streams[streamsIndex].PrimaryKey[primaryKeyIndex] {
					primaryKeyTmp = append(primaryKeyTmp, r.Configurations.Streams[streamsIndex].PrimaryKey[primaryKeyIndex][index].ValueString())
				}
				primaryKey = append(primaryKey, primaryKeyTmp)
			}
			includeFiles := new(bool)
			if !r.Configurations.Streams[streamsIndex].IncludeFiles.IsUnknown() && !r.Configurations.Streams[streamsIndex].IncludeFiles.IsNull() {
				*includeFiles = r.Configurations.Streams[streamsIndex].IncludeFiles.ValueBool()
			} else {
				includeFiles = nil
			}
			destinationObjectName := new(string)
			if !r.Configurations.Streams[streamsIndex].DestinationObjectName.IsUnknown() && !r.Configurations.Streams[streamsIndex].DestinationObjectName.IsNull() {
				*destinationObjectName = r.Configurations.Streams[streamsIndex].DestinationObjectName.ValueString()
			} else {
				destinationObjectName = nil
			}
			selectedFields := make([]shared.SelectedFieldInfo, 0, len(r.Configurations.Streams[streamsIndex].SelectedFields))
			for selectedFieldsIndex := range r.Configurations.Streams[streamsIndex].SelectedFields {
				fieldPath := make([]string, 0, len(r.Configurations.Streams[streamsIndex].SelectedFields[selectedFieldsIndex].FieldPath))
				for fieldPathIndex := range r.Configurations.Streams[streamsIndex].SelectedFields[selectedFieldsIndex].FieldPath {
					fieldPath = append(fieldPath, r.Configurations.Streams[streamsIndex].SelectedFields[selectedFieldsIndex].FieldPath[fieldPathIndex].ValueString())
				}
				selectedFields = append(selectedFields, shared.SelectedFieldInfo{
					FieldPath: fieldPath,
				})
			}
			mappers := make([]shared.ConfiguredStreamMapper, 0, len(r.Configurations.Streams[streamsIndex].Mappers))
			for mappersIndex := range r.Configurations.Streams[streamsIndex].Mappers {
				id := new(string)
				if !r.Configurations.Streams[streamsIndex].Mappers[mappersIndex].ID.IsUnknown() && !r.Configurations.Streams[streamsIndex].Mappers[mappersIndex].ID.IsNull() {
					*id = r.Configurations.Streams[streamsIndex].Mappers[mappersIndex].ID.ValueString()
				} else {
					id = nil
				}
				typeVar := shared.StreamMapperType(r.Configurations.Streams[streamsIndex].Mappers[mappersIndex].Type.ValueString())
				var mapperConfiguration shared.MapperConfiguration
				var hashing *shared.Hashing
				if r.Configurations.Streams[streamsIndex].Mappers[mappersIndex].MapperConfiguration.Hashing != nil {
					var fieldNameSuffix string
					fieldNameSuffix = r.Configurations.Streams[streamsIndex].Mappers[mappersIndex].MapperConfiguration.Hashing.FieldNameSuffix.ValueString()

					method := shared.HashingMethod(r.Configurations.Streams[streamsIndex].Mappers[mappersIndex].MapperConfiguration.Hashing.Method.ValueString())
					var targetField string
					targetField = r.Configurations.Streams[streamsIndex].Mappers[mappersIndex].MapperConfiguration.Hashing.TargetField.ValueString()

					hashing = &shared.Hashing{
						FieldNameSuffix: fieldNameSuffix,
						Method:          method,
						TargetField:     targetField,
					}
				}
				if hashing != nil {
					mapperConfiguration = shared.MapperConfiguration{
						Hashing: hashing,
					}
				}
				var fieldFiltering *shared.FieldFiltering
				if r.Configurations.Streams[streamsIndex].Mappers[mappersIndex].MapperConfiguration.FieldFiltering != nil {
					var targetField1 string
					targetField1 = r.Configurations.Streams[streamsIndex].Mappers[mappersIndex].MapperConfiguration.FieldFiltering.TargetField.ValueString()

					fieldFiltering = &shared.FieldFiltering{
						TargetField: targetField1,
					}
				}
				if fieldFiltering != nil {
					mapperConfiguration = shared.MapperConfiguration{
						FieldFiltering: fieldFiltering,
					}
				}
				var fieldRenaming *shared.FieldRenaming
				if r.Configurations.Streams[streamsIndex].Mappers[mappersIndex].MapperConfiguration.FieldRenaming != nil {
					var newFieldName string
					newFieldName = r.Configurations.Streams[streamsIndex].Mappers[mappersIndex].MapperConfiguration.FieldRenaming.NewFieldName.ValueString()

					var originalFieldName string
					originalFieldName = r.Configurations.Streams[streamsIndex].Mappers[mappersIndex].MapperConfiguration.FieldRenaming.OriginalFieldName.ValueString()

					fieldRenaming = &shared.FieldRenaming{
						NewFieldName:      newFieldName,
						OriginalFieldName: originalFieldName,
					}
				}
				if fieldRenaming != nil {
					mapperConfiguration = shared.MapperConfiguration{
						FieldRenaming: fieldRenaming,
					}
				}
				var rowFiltering *shared.RowFiltering
				if r.Configurations.Streams[streamsIndex].Mappers[mappersIndex].MapperConfiguration.RowFiltering != nil {
					var conditions interface{}
					_ = json.Unmarshal([]byte(r.Configurations.Streams[streamsIndex].Mappers[mappersIndex].MapperConfiguration.RowFiltering.Conditions.ValueString()), &conditions)
					rowFiltering = &shared.RowFiltering{
						Conditions: conditions,
					}
				}
				if rowFiltering != nil {
					mapperConfiguration = shared.MapperConfiguration{
						RowFiltering: rowFiltering,
					}
				}
				var encryption *shared.Encryption
				if r.Configurations.Streams[streamsIndex].Mappers[mappersIndex].MapperConfiguration.Encryption != nil {
					var encryptionMapperRSAConfiguration *shared.EncryptionMapperRSAConfiguration
					if r.Configurations.Streams[streamsIndex].Mappers[mappersIndex].MapperConfiguration.Encryption.Rsa != nil {
						algorithm := shared.EncryptionMapperAlgorithm(r.Configurations.Streams[streamsIndex].Mappers[mappersIndex].MapperConfiguration.Encryption.Rsa.Algorithm.ValueString())
						var fieldNameSuffix1 string
						fieldNameSuffix1 = r.Configurations.Streams[streamsIndex].Mappers[mappersIndex].MapperConfiguration.Encryption.Rsa.FieldNameSuffix.ValueString()

						var publicKey string
						publicKey = r.Configurations.Streams[streamsIndex].Mappers[mappersIndex].MapperConfiguration.Encryption.Rsa.PublicKey.ValueString()

						var targetField2 string
						targetField2 = r.Configurations.Streams[streamsIndex].Mappers[mappersIndex].MapperConfiguration.Encryption.Rsa.TargetField.ValueString()

						encryptionMapperRSAConfiguration = &shared.EncryptionMapperRSAConfiguration{
							Algorithm:       algorithm,
							FieldNameSuffix: fieldNameSuffix1,
							PublicKey:       publicKey,
							TargetField:     targetField2,
						}
					}
					if encryptionMapperRSAConfiguration != nil {
						encryption = &shared.Encryption{
							EncryptionMapperRSAConfiguration: encryptionMapperRSAConfiguration,
						}
					}
					var encryptionMapperAESConfiguration *shared.EncryptionMapperAESConfiguration
					if r.Configurations.Streams[streamsIndex].Mappers[mappersIndex].MapperConfiguration.Encryption.Aes != nil {
						algorithm1 := shared.EncryptionMapperAlgorithm(r.Configurations.Streams[streamsIndex].Mappers[mappersIndex].MapperConfiguration.Encryption.Aes.Algorithm.ValueString())
						var fieldNameSuffix2 string
						fieldNameSuffix2 = r.Configurations.Streams[streamsIndex].Mappers[mappersIndex].MapperConfiguration.Encryption.Aes.FieldNameSuffix.ValueString()

						var key string
						key = r.Configurations.Streams[streamsIndex].Mappers[mappersIndex].MapperConfiguration.Encryption.Aes.Key.ValueString()

						mode := shared.Mode(r.Configurations.Streams[streamsIndex].Mappers[mappersIndex].MapperConfiguration.Encryption.Aes.Mode.ValueString())
						padding := shared.Padding(r.Configurations.Streams[streamsIndex].Mappers[mappersIndex].MapperConfiguration.Encryption.Aes.Padding.ValueString())
						var targetField3 string
						targetField3 = r.Configurations.Streams[streamsIndex].Mappers[mappersIndex].MapperConfiguration.Encryption.Aes.TargetField.ValueString()

						encryptionMapperAESConfiguration = &shared.EncryptionMapperAESConfiguration{
							Algorithm:       algorithm1,
							FieldNameSuffix: fieldNameSuffix2,
							Key:             key,
							Mode:            mode,
							Padding:         padding,
							TargetField:     targetField3,
						}
					}
					if encryptionMapperAESConfiguration != nil {
						encryption = &shared.Encryption{
							EncryptionMapperAESConfiguration: encryptionMapperAESConfiguration,
						}
					}
				}
				if encryption != nil {
					mapperConfiguration = shared.MapperConfiguration{
						Encryption: encryption,
					}
				}
				mappers = append(mappers, shared.ConfiguredStreamMapper{
					ID:                  id,
					Type:                typeVar,
					MapperConfiguration: mapperConfiguration,
				})
			}
			streams = append(streams, shared.StreamConfiguration{
				Name:                  name1,
				Namespace:             namespace,
				SyncMode:              syncMode,
				CursorField:           cursorField,
				PrimaryKey:            primaryKey,
				IncludeFiles:          includeFiles,
				DestinationObjectName: destinationObjectName,
				SelectedFields:        selectedFields,
				Mappers:               mappers,
			})
		}
		configurations = &shared.StreamConfigurations{
			Streams: streams,
		}
	}
	var schedule *shared.AirbyteAPIConnectionSchedule
	if r.Schedule != nil {
		scheduleType := shared.ScheduleTypeEnum(r.Schedule.ScheduleType.ValueString())
		cronExpression := new(string)
		if !r.Schedule.CronExpression.IsUnknown() && !r.Schedule.CronExpression.IsNull() {
			*cronExpression = r.Schedule.CronExpression.ValueString()
		} else {
			cronExpression = nil
		}
		schedule = &shared.AirbyteAPIConnectionSchedule{
			ScheduleType:   scheduleType,
			CronExpression: cronExpression,
		}
	}
	dataResidency := new(string)
	if !r.DataResidency.IsUnknown() && !r.DataResidency.IsNull() {
		*dataResidency = r.DataResidency.ValueString()
	} else {
		dataResidency = nil
	}
	namespaceDefinition := new(shared.NamespaceDefinitionEnumNoDefault)
	if !r.NamespaceDefinition.IsUnknown() && !r.NamespaceDefinition.IsNull() {
		*namespaceDefinition = shared.NamespaceDefinitionEnumNoDefault(r.NamespaceDefinition.ValueString())
	} else {
		namespaceDefinition = nil
	}
	namespaceFormat := new(string)
	if !r.NamespaceFormat.IsUnknown() && !r.NamespaceFormat.IsNull() {
		*namespaceFormat = r.NamespaceFormat.ValueString()
	} else {
		namespaceFormat = nil
	}
	prefix := new(string)
	if !r.Prefix.IsUnknown() && !r.Prefix.IsNull() {
		*prefix = r.Prefix.ValueString()
	} else {
		prefix = nil
	}
	nonBreakingSchemaUpdatesBehavior := new(shared.NonBreakingSchemaUpdatesBehaviorEnumNoDefault)
	if !r.NonBreakingSchemaUpdatesBehavior.IsUnknown() && !r.NonBreakingSchemaUpdatesBehavior.IsNull() {
		*nonBreakingSchemaUpdatesBehavior = shared.NonBreakingSchemaUpdatesBehaviorEnumNoDefault(r.NonBreakingSchemaUpdatesBehavior.ValueString())
	} else {
		nonBreakingSchemaUpdatesBehavior = nil
	}
	status := new(shared.ConnectionStatusEnum)
	if !r.Status.IsUnknown() && !r.Status.IsNull() {
		*status = shared.ConnectionStatusEnum(r.Status.ValueString())
	} else {
		status = nil
	}
	tags := make([]shared.Tag, 0, len(r.Tags))
	for tagsIndex := range r.Tags {
		var tagID string
		tagID = r.Tags[tagsIndex].TagID.ValueString()

		var workspaceID string
		workspaceID = r.Tags[tagsIndex].WorkspaceID.ValueString()

		var name2 string
		name2 = r.Tags[tagsIndex].Name.ValueString()

		var color string
		color = r.Tags[tagsIndex].Color.ValueString()

		tags = append(tags, shared.Tag{
			TagID:       tagID,
			WorkspaceID: workspaceID,
			Name:        name2,
			Color:       color,
		})
	}
	out := shared.ConnectionPatchRequest{
		Name:                             name,
		Configurations:                   configurations,
		Schedule:                         schedule,
		DataResidency:                    dataResidency,
		NamespaceDefinition:              namespaceDefinition,
		NamespaceFormat:                  namespaceFormat,
		Prefix:                           prefix,
		NonBreakingSchemaUpdatesBehavior: nonBreakingSchemaUpdatesBehavior,
		Status:                           status,
		Tags:                             tags,
	}

	return &out, diags
}
