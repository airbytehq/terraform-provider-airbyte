// Code generated by Speakeasy (https://speakeasy.com). DO NOT EDIT.

package provider

import (
	"context"
	"encoding/json"
	tfTypes "github.com/airbytehq/terraform-provider-airbyte/internal/provider/types"
	"github.com/airbytehq/terraform-provider-airbyte/internal/sdk/models/operations"
	"github.com/airbytehq/terraform-provider-airbyte/internal/sdk/models/shared"
	"github.com/hashicorp/terraform-plugin-framework-jsontypes/jsontypes"
	"github.com/hashicorp/terraform-plugin-framework/diag"
	"github.com/hashicorp/terraform-plugin-framework/types"
)

func (r *ConnectionsDataSourceModel) RefreshFromSharedConnectionsResponse(ctx context.Context, resp *shared.ConnectionsResponse) diag.Diagnostics {
	var diags diag.Diagnostics

	if resp != nil {
		r.Data = []tfTypes.ConnectionResponse{}

		for _, dataItem := range resp.Data {
			var data tfTypes.ConnectionResponse

			data.Configurations = &tfTypes.StreamConfigurations{}
			data.Configurations.Streams = []tfTypes.StreamConfiguration{}

			for _, streamsItem := range dataItem.Configurations.Streams {
				var streams tfTypes.StreamConfiguration

				streams.CursorField = make([]types.String, 0, len(streamsItem.CursorField))
				for _, v := range streamsItem.CursorField {
					streams.CursorField = append(streams.CursorField, types.StringValue(v))
				}
				streams.DestinationObjectName = types.StringPointerValue(streamsItem.DestinationObjectName)
				streams.IncludeFiles = types.BoolPointerValue(streamsItem.IncludeFiles)
				streams.Mappers = []tfTypes.ConfiguredStreamMapper{}

				for _, mappersItem := range streamsItem.Mappers {
					var mappers tfTypes.ConfiguredStreamMapper

					mappers.ID = types.StringPointerValue(mappersItem.ID)
					if mappersItem.MapperConfiguration.Encryption != nil {
						mappers.MapperConfiguration.Encryption = &tfTypes.Encryption{}
						if mappersItem.MapperConfiguration.Encryption.EncryptionMapperAESConfiguration != nil {
							mappers.MapperConfiguration.Encryption.Aes = &tfTypes.EncryptionMapperAESConfiguration{}
							mappers.MapperConfiguration.Encryption.Aes.Algorithm = types.StringValue(string(mappersItem.MapperConfiguration.Encryption.EncryptionMapperAESConfiguration.Algorithm))
							mappers.MapperConfiguration.Encryption.Aes.FieldNameSuffix = types.StringValue(mappersItem.MapperConfiguration.Encryption.EncryptionMapperAESConfiguration.FieldNameSuffix)
							mappers.MapperConfiguration.Encryption.Aes.Key = types.StringValue(mappersItem.MapperConfiguration.Encryption.EncryptionMapperAESConfiguration.Key)
							mappers.MapperConfiguration.Encryption.Aes.Mode = types.StringValue(string(mappersItem.MapperConfiguration.Encryption.EncryptionMapperAESConfiguration.Mode))
							mappers.MapperConfiguration.Encryption.Aes.Padding = types.StringValue(string(mappersItem.MapperConfiguration.Encryption.EncryptionMapperAESConfiguration.Padding))
							mappers.MapperConfiguration.Encryption.Aes.TargetField = types.StringValue(mappersItem.MapperConfiguration.Encryption.EncryptionMapperAESConfiguration.TargetField)
						}
						if mappersItem.MapperConfiguration.Encryption.EncryptionMapperRSAConfiguration != nil {
							mappers.MapperConfiguration.Encryption.Rsa = &tfTypes.EncryptionMapperRSAConfiguration{}
							mappers.MapperConfiguration.Encryption.Rsa.Algorithm = types.StringValue(string(mappersItem.MapperConfiguration.Encryption.EncryptionMapperRSAConfiguration.Algorithm))
							mappers.MapperConfiguration.Encryption.Rsa.FieldNameSuffix = types.StringValue(mappersItem.MapperConfiguration.Encryption.EncryptionMapperRSAConfiguration.FieldNameSuffix)
							mappers.MapperConfiguration.Encryption.Rsa.PublicKey = types.StringValue(mappersItem.MapperConfiguration.Encryption.EncryptionMapperRSAConfiguration.PublicKey)
							mappers.MapperConfiguration.Encryption.Rsa.TargetField = types.StringValue(mappersItem.MapperConfiguration.Encryption.EncryptionMapperRSAConfiguration.TargetField)
						}
					}
					if mappersItem.MapperConfiguration.FieldFiltering != nil {
						mappers.MapperConfiguration.FieldFiltering = &tfTypes.FieldFiltering{}
						mappers.MapperConfiguration.FieldFiltering.TargetField = types.StringValue(mappersItem.MapperConfiguration.FieldFiltering.TargetField)
					}
					if mappersItem.MapperConfiguration.FieldRenaming != nil {
						mappers.MapperConfiguration.FieldRenaming = &tfTypes.FieldRenaming{}
						mappers.MapperConfiguration.FieldRenaming.NewFieldName = types.StringValue(mappersItem.MapperConfiguration.FieldRenaming.NewFieldName)
						mappers.MapperConfiguration.FieldRenaming.OriginalFieldName = types.StringValue(mappersItem.MapperConfiguration.FieldRenaming.OriginalFieldName)
					}
					if mappersItem.MapperConfiguration.Hashing != nil {
						mappers.MapperConfiguration.Hashing = &tfTypes.Hashing{}
						mappers.MapperConfiguration.Hashing.FieldNameSuffix = types.StringValue(mappersItem.MapperConfiguration.Hashing.FieldNameSuffix)
						mappers.MapperConfiguration.Hashing.Method = types.StringValue(string(mappersItem.MapperConfiguration.Hashing.Method))
						mappers.MapperConfiguration.Hashing.TargetField = types.StringValue(mappersItem.MapperConfiguration.Hashing.TargetField)
					}
					if mappersItem.MapperConfiguration.RowFiltering != nil {
						mappers.MapperConfiguration.RowFiltering = &tfTypes.RowFiltering{}
						conditionsResult, _ := json.Marshal(mappersItem.MapperConfiguration.RowFiltering.Conditions)
						mappers.MapperConfiguration.RowFiltering.Conditions = jsontypes.NewNormalizedValue(string(conditionsResult))
					}
					mappers.Type = types.StringValue(string(mappersItem.Type))

					streams.Mappers = append(streams.Mappers, mappers)
				}
				streams.Name = types.StringValue(streamsItem.Name)
				streams.Namespace = types.StringPointerValue(streamsItem.Namespace)
				streams.PrimaryKey = nil
				for _, primaryKeyItem := range streamsItem.PrimaryKey {
					var primaryKey []types.String
					primaryKey = make([]types.String, 0, len(primaryKeyItem))
					for _, v := range primaryKeyItem {
						primaryKey = append(primaryKey, types.StringValue(v))
					}
					streams.PrimaryKey = append(streams.PrimaryKey, primaryKey)
				}
				streams.SelectedFields = []tfTypes.SelectedFieldInfo{}

				for _, selectedFieldsItem := range streamsItem.SelectedFields {
					var selectedFields tfTypes.SelectedFieldInfo

					selectedFields.FieldPath = make([]types.String, 0, len(selectedFieldsItem.FieldPath))
					for _, v := range selectedFieldsItem.FieldPath {
						selectedFields.FieldPath = append(selectedFields.FieldPath, types.StringValue(v))
					}

					streams.SelectedFields = append(streams.SelectedFields, selectedFields)
				}
				if streamsItem.SyncMode != nil {
					streams.SyncMode = types.StringValue(string(*streamsItem.SyncMode))
				} else {
					streams.SyncMode = types.StringNull()
				}

				data.Configurations.Streams = append(data.Configurations.Streams, streams)
			}
			data.ConnectionID = types.StringValue(dataItem.ConnectionID)
			data.CreatedAt = types.Int64Value(dataItem.CreatedAt)
			data.DestinationID = types.StringValue(dataItem.DestinationID)
			data.Name = types.StringValue(dataItem.Name)
			if dataItem.NamespaceDefinition != nil {
				data.NamespaceDefinition = types.StringValue(string(*dataItem.NamespaceDefinition))
			} else {
				data.NamespaceDefinition = types.StringNull()
			}
			data.NamespaceFormat = types.StringPointerValue(dataItem.NamespaceFormat)
			if dataItem.NonBreakingSchemaUpdatesBehavior != nil {
				data.NonBreakingSchemaUpdatesBehavior = types.StringValue(string(*dataItem.NonBreakingSchemaUpdatesBehavior))
			} else {
				data.NonBreakingSchemaUpdatesBehavior = types.StringNull()
			}
			data.Prefix = types.StringPointerValue(dataItem.Prefix)
			data.Schedule = &tfTypes.ConnectionScheduleResponse{}
			data.Schedule.BasicTiming = types.StringPointerValue(dataItem.Schedule.BasicTiming)
			data.Schedule.CronExpression = types.StringPointerValue(dataItem.Schedule.CronExpression)
			data.Schedule.ScheduleType = types.StringValue(string(dataItem.Schedule.ScheduleType))
			data.SourceID = types.StringValue(dataItem.SourceID)
			data.Status = types.StringValue(string(dataItem.Status))
			data.StatusReason = types.StringPointerValue(dataItem.StatusReason)
			data.Tags = []tfTypes.Tag{}

			for _, tagsItem := range dataItem.Tags {
				var tags tfTypes.Tag

				tags.Color = types.StringValue(tagsItem.Color)
				tags.Name = types.StringValue(tagsItem.Name)
				tags.TagID = types.StringValue(tagsItem.TagID)
				tags.WorkspaceID = types.StringValue(tagsItem.WorkspaceID)

				data.Tags = append(data.Tags, tags)
			}
			data.WorkspaceID = types.StringValue(dataItem.WorkspaceID)

			r.Data = append(r.Data, data)
		}
		r.Next = types.StringPointerValue(resp.Next)
		r.Previous = types.StringPointerValue(resp.Previous)
	}

	return diags
}

func (r *ConnectionsDataSourceModel) ToOperationsListConnectionsRequest(ctx context.Context) (*operations.ListConnectionsRequest, diag.Diagnostics) {
	var diags diag.Diagnostics

	workspaceIds := make([]string, 0, len(r.WorkspaceIds))
	for workspaceIdsIndex := range r.WorkspaceIds {
		workspaceIds = append(workspaceIds, r.WorkspaceIds[workspaceIdsIndex].ValueString())
	}
	tagIds := make([]string, 0, len(r.TagIds))
	for tagIdsIndex := range r.TagIds {
		tagIds = append(tagIds, r.TagIds[tagIdsIndex].ValueString())
	}
	includeDeleted := new(bool)
	if !r.IncludeDeleted.IsUnknown() && !r.IncludeDeleted.IsNull() {
		*includeDeleted = r.IncludeDeleted.ValueBool()
	} else {
		includeDeleted = nil
	}
	limit := new(int)
	if !r.Limit.IsUnknown() && !r.Limit.IsNull() {
		*limit = int(r.Limit.ValueInt32())
	} else {
		limit = nil
	}
	offset := new(int)
	if !r.Offset.IsUnknown() && !r.Offset.IsNull() {
		*offset = int(r.Offset.ValueInt32())
	} else {
		offset = nil
	}
	out := operations.ListConnectionsRequest{
		WorkspaceIds:   workspaceIds,
		TagIds:         tagIds,
		IncludeDeleted: includeDeleted,
		Limit:          limit,
		Offset:         offset,
	}

	return &out, diags
}
