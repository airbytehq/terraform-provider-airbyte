// Code generated by Speakeasy (https://speakeasy.com). DO NOT EDIT.

package objectplanmodifier

import (
	"context"

	"github.com/airbytehq/terraform-provider-airbyte/internal/planmodifiers/utils"
	"github.com/hashicorp/terraform-plugin-framework/resource/schema/planmodifier"
	"github.com/hashicorp/terraform-plugin-framework/types"
)

// UseHoistedValue returns a plan modifier that copies the value from the active
// oneOf variant to the hoisted field at the parent level.
func UseHoistedValue(sources []utils.HoistedSource) planmodifier.Object {
	return useHoistedValue{sources: sources}
}

type useHoistedValue struct {
	sources []utils.HoistedSource
}

func (m useHoistedValue) Description(_ context.Context) string {
	return "Copies value from active oneOf variant to this hoisted field."
}

func (m useHoistedValue) MarkdownDescription(_ context.Context) string {
	return "Copies value from active oneOf variant to this hoisted field."
}

func (m useHoistedValue) PlanModifyObject(ctx context.Context, req planmodifier.ObjectRequest, resp *planmodifier.ObjectResponse) {
	if !req.PlanValue.IsUnknown() {
		return
	}
	if utils.IsAllStateUnknown(ctx, req.State) {
		return
	}

	if fieldValue := utils.FindActiveHoistedValue[types.Object](ctx, req.Plan, req.State, m.sources); fieldValue != nil {
		resp.PlanValue = *fieldValue
		return
	}

	if !req.StateValue.IsNull() && !req.StateValue.IsUnknown() {
		resp.PlanValue = req.StateValue
	}
}
