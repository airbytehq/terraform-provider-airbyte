// Code generated by Speakeasy (https://speakeasy.com). DO NOT EDIT.

package shared

import (
	"encoding/json"
	"errors"
	"fmt"
	"github.com/airbytehq/terraform-provider-airbyte/internal/sdk/internal/utils"
	"github.com/airbytehq/terraform-provider-airbyte/internal/sdk/types"
	"time"
)

// SourceTrustpilotAPIKey - The API key authentication method gives you access to only the streams which are part of the Public API. When you want to get streams available via the Consumer API (e.g. the private reviews) you need to use authentication method OAuth 2.0.
type SourceTrustpilotAPIKey struct {
	authType *string `const:"apikey" json:"auth_type,omitempty"`
	// The API key of the Trustpilot API application.
	ClientID string `json:"client_id"`
}

func (s SourceTrustpilotAPIKey) MarshalJSON() ([]byte, error) {
	return utils.MarshalJSON(s, "", false)
}

func (s *SourceTrustpilotAPIKey) UnmarshalJSON(data []byte) error {
	if err := utils.UnmarshalJSON(data, &s, "", false, nil); err != nil {
		return err
	}
	return nil
}

func (s *SourceTrustpilotAPIKey) GetAuthType() *string {
	return types.Pointer("apikey")
}

func (s *SourceTrustpilotAPIKey) GetClientID() string {
	if s == nil {
		return ""
	}
	return s.ClientID
}

type SourceTrustpilotOAuth20 struct {
	// Access Token for making authenticated requests.
	AccessToken string  `json:"access_token"`
	authType    *string `const:"oauth2.0" json:"auth_type,omitempty"`
	// The API key of the Trustpilot API application. (represents the OAuth Client ID)
	ClientID string `json:"client_id"`
	// The Secret of the Trustpilot API application. (represents the OAuth Client Secret)
	ClientSecret string `json:"client_secret"`
	// The key to refresh the expired access_token.
	RefreshToken string `json:"refresh_token"`
	// The date-time when the access token should be refreshed.
	TokenExpiryDate time.Time `json:"token_expiry_date"`
}

func (s SourceTrustpilotOAuth20) MarshalJSON() ([]byte, error) {
	return utils.MarshalJSON(s, "", false)
}

func (s *SourceTrustpilotOAuth20) UnmarshalJSON(data []byte) error {
	if err := utils.UnmarshalJSON(data, &s, "", false, nil); err != nil {
		return err
	}
	return nil
}

func (s *SourceTrustpilotOAuth20) GetAccessToken() string {
	if s == nil {
		return ""
	}
	return s.AccessToken
}

func (s *SourceTrustpilotOAuth20) GetAuthType() *string {
	return types.Pointer("oauth2.0")
}

func (s *SourceTrustpilotOAuth20) GetClientID() string {
	if s == nil {
		return ""
	}
	return s.ClientID
}

func (s *SourceTrustpilotOAuth20) GetClientSecret() string {
	if s == nil {
		return ""
	}
	return s.ClientSecret
}

func (s *SourceTrustpilotOAuth20) GetRefreshToken() string {
	if s == nil {
		return ""
	}
	return s.RefreshToken
}

func (s *SourceTrustpilotOAuth20) GetTokenExpiryDate() time.Time {
	if s == nil {
		return time.Time{}
	}
	return s.TokenExpiryDate
}

type SourceTrustpilotAuthorizationMethodType string

const (
	SourceTrustpilotAuthorizationMethodTypeSourceTrustpilotOAuth20 SourceTrustpilotAuthorizationMethodType = "source-trustpilot_OAuth 2.0"
	SourceTrustpilotAuthorizationMethodTypeSourceTrustpilotAPIKey  SourceTrustpilotAuthorizationMethodType = "source-trustpilot_API Key"
)

type SourceTrustpilotAuthorizationMethod struct {
	SourceTrustpilotOAuth20 *SourceTrustpilotOAuth20 `queryParam:"inline" union:"member"`
	SourceTrustpilotAPIKey  *SourceTrustpilotAPIKey  `queryParam:"inline" union:"member"`

	Type SourceTrustpilotAuthorizationMethodType
}

func CreateSourceTrustpilotAuthorizationMethodSourceTrustpilotOAuth20(sourceTrustpilotOAuth20 SourceTrustpilotOAuth20) SourceTrustpilotAuthorizationMethod {
	typ := SourceTrustpilotAuthorizationMethodTypeSourceTrustpilotOAuth20

	return SourceTrustpilotAuthorizationMethod{
		SourceTrustpilotOAuth20: &sourceTrustpilotOAuth20,
		Type:                    typ,
	}
}

func CreateSourceTrustpilotAuthorizationMethodSourceTrustpilotAPIKey(sourceTrustpilotAPIKey SourceTrustpilotAPIKey) SourceTrustpilotAuthorizationMethod {
	typ := SourceTrustpilotAuthorizationMethodTypeSourceTrustpilotAPIKey

	return SourceTrustpilotAuthorizationMethod{
		SourceTrustpilotAPIKey: &sourceTrustpilotAPIKey,
		Type:                   typ,
	}
}

func (u *SourceTrustpilotAuthorizationMethod) UnmarshalJSON(data []byte) error {

	var candidates []utils.UnionCandidate

	// Collect all valid candidates
	var sourceTrustpilotOAuth20 SourceTrustpilotOAuth20 = SourceTrustpilotOAuth20{}
	if err := utils.UnmarshalJSON(data, &sourceTrustpilotOAuth20, "", true, nil); err == nil {
		candidates = append(candidates, utils.UnionCandidate{
			Type:  SourceTrustpilotAuthorizationMethodTypeSourceTrustpilotOAuth20,
			Value: &sourceTrustpilotOAuth20,
		})
	}

	var sourceTrustpilotAPIKey SourceTrustpilotAPIKey = SourceTrustpilotAPIKey{}
	if err := utils.UnmarshalJSON(data, &sourceTrustpilotAPIKey, "", true, nil); err == nil {
		candidates = append(candidates, utils.UnionCandidate{
			Type:  SourceTrustpilotAuthorizationMethodTypeSourceTrustpilotAPIKey,
			Value: &sourceTrustpilotAPIKey,
		})
	}

	if len(candidates) == 0 {
		return fmt.Errorf("could not unmarshal `%s` into any supported union types for SourceTrustpilotAuthorizationMethod", string(data))
	}

	// Pick the best candidate using multi-stage filtering
	best := utils.PickBestUnionCandidate(candidates, data)
	if best == nil {
		return fmt.Errorf("could not unmarshal `%s` into any supported union types for SourceTrustpilotAuthorizationMethod", string(data))
	}

	// Set the union type and value based on the best candidate
	u.Type = best.Type.(SourceTrustpilotAuthorizationMethodType)
	switch best.Type {
	case SourceTrustpilotAuthorizationMethodTypeSourceTrustpilotOAuth20:
		u.SourceTrustpilotOAuth20 = best.Value.(*SourceTrustpilotOAuth20)
		return nil
	case SourceTrustpilotAuthorizationMethodTypeSourceTrustpilotAPIKey:
		u.SourceTrustpilotAPIKey = best.Value.(*SourceTrustpilotAPIKey)
		return nil
	}

	return fmt.Errorf("could not unmarshal `%s` into any supported union types for SourceTrustpilotAuthorizationMethod", string(data))
}

func (u SourceTrustpilotAuthorizationMethod) MarshalJSON() ([]byte, error) {
	if u.SourceTrustpilotOAuth20 != nil {
		return utils.MarshalJSON(u.SourceTrustpilotOAuth20, "", true)
	}

	if u.SourceTrustpilotAPIKey != nil {
		return utils.MarshalJSON(u.SourceTrustpilotAPIKey, "", true)
	}

	return nil, errors.New("could not marshal union type SourceTrustpilotAuthorizationMethod: all fields are null")
}

type SourceTrustpilotSourceType string

const (
	SourceTrustpilotSourceTypeTrustpilot SourceTrustpilotSourceType = "trustpilot"
)

func (e SourceTrustpilotSourceType) ToPointer() *SourceTrustpilotSourceType {
	return &e
}
func (e *SourceTrustpilotSourceType) UnmarshalJSON(data []byte) error {
	var v string
	if err := json.Unmarshal(data, &v); err != nil {
		return err
	}
	switch v {
	case "trustpilot":
		*e = SourceTrustpilotSourceType(v)
		return nil
	default:
		return fmt.Errorf("invalid value for SourceTrustpilotSourceType: %v", v)
	}
}

type SourceTrustpilot struct {
	// The names of business units which shall be synchronized. Some streams e.g. configured_business_units or private_reviews use this configuration.
	BusinessUnits []string                            `json:"business_units"`
	Credentials   SourceTrustpilotAuthorizationMethod `json:"credentials"`
	// For streams with sync. method incremental the start date time to be used
	StartDate            string                      `json:"start_date"`
	sourceType           *SourceTrustpilotSourceType `const:"trustpilot" json:"sourceType"`
	AdditionalProperties any                         `additionalProperties:"true" json:"-"`
}

func (s SourceTrustpilot) MarshalJSON() ([]byte, error) {
	return utils.MarshalJSON(s, "", false)
}

func (s *SourceTrustpilot) UnmarshalJSON(data []byte) error {
	if err := utils.UnmarshalJSON(data, &s, "", false, nil); err != nil {
		return err
	}
	return nil
}

func (s *SourceTrustpilot) GetBusinessUnits() []string {
	if s == nil {
		return []string{}
	}
	return s.BusinessUnits
}

func (s *SourceTrustpilot) GetCredentials() SourceTrustpilotAuthorizationMethod {
	if s == nil {
		return SourceTrustpilotAuthorizationMethod{}
	}
	return s.Credentials
}

func (s *SourceTrustpilot) GetStartDate() string {
	if s == nil {
		return ""
	}
	return s.StartDate
}

func (s *SourceTrustpilot) GetSourceType() *SourceTrustpilotSourceType {
	return SourceTrustpilotSourceTypeTrustpilot.ToPointer()
}

func (s *SourceTrustpilot) GetAdditionalProperties() any {
	if s == nil {
		return nil
	}
	return s.AdditionalProperties
}
